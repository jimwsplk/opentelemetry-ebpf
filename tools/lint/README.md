# Linting & Static Check

## Clang-format (C, C++)
We use _clang-format-7.0.1_ to format C, C++ and Protobuf source files.

The clang-format configuration file is located at '${ROOT}/.clang-format'. The
format is based on LLVM style, with following tweak:
```
  AllowShortFunctionsOnASingleLine: Inline
  BreakBeforeBraces: Stroustrup
```

Unfortunately different versions of _clang-format_ are not compitable. (For example, 
clang-format-6.0 cannot read the config generated by clang-format-6.0). Thus, please
download/install _clang-format-7.0.1_ using the script 'download-clang-format.sh'
or manually from the URL:
* http://releases.llvm.org/download.html#7.0.1

'download-clang-format.sh' supports Linux Mint, Ubuntu 18.04, and MacOS X (for mac, 
downloads 7.0.0), and places clang-format in $HOME/bin. You can either:
* add clang-format to your PATH environment variable via 'export PATH=$PATH:$HOME/bin`
in .bash_profile or .bashrc
* set the 'CLANG_7_0_1' environment variable to the downloaded clang-format, e.g.,
'export CLANG_7_0_1=$HOME/bin/clang-format'.

A less recommended method is to use clang-format inside a docker container, and use the
container as an executable. You can build the container using the 'build-and-deploy.sh'
script, which will tag 'clang-format:7.0.1' on an Ubuntu 18.04 container. To run,
'docker run -it clang-format:7.0.1 <params>', however it seems the docker bootstrap has
around 0.9-1.0 seconds overhead per run.


### run-clang-format.sh
This script is for running _clang-format_ manually on command line.

Usage:

```
  run-clang-format.sh <FILE1> [FILE2, ...]

  # Globbing works
  run-clang-format.sh *.cc 
```

### pre-commit.sh
This is a git-hook script is used to run _clang-format_ over the to-be-commit
source file(s).

One might want to link this script to .git/hook/
```
  cd .git/hook
  ln -s ../../tools/lint/pre-commit .
```

(We would/should update this script to include more checks)    
